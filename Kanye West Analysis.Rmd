---
title: "Kanye West Sentiment Analysis"
author: "Stella Huang"
date: "August 2018"
output: html_notebook

---

###Introduction
Kanye West has been one of the hottest rappers in the game since the early 2000s. Whether it be releasing new singles without notice, dauntlessly stealing the mic during an award show, or blasting his twitter feed with cryptic tweets, his unpredictable behavior is now not unfamiliar to his fans and even the public. Musically, his works can lie on opposite sides of the spectrum; there are songs like “Gold Digger” and “Stronger” that obsess over desired attributes, while songs like “Hey Mama” and “Runaway” reveal his more vulnerable side. 

Simultaneously, various libraries in R enable us to perform text mining on any written text. Such libraries have functions that can dissect large chunks of text into singular words and provide more convenient means to alter data via the utilization of tibbles (I like to call it the smarter cousin of dataframes). There are even means to categorize and assign scores to words based on their denotation, which can be powerful in identifying patterns and grasping a general understanding of the text.


###Purpose
The purpose of this project is to lyrically analyze how Kanye West’s albums have changed over time. This project focuses on dissecting the artist’s lyrics by sentiments and examining how such sentiments have individually and holistically altered during the artist’s career; it utilizes text mining and Natural Language Processing techniques.

In this analysis, I primarily used the Genius API to scrapp West’s lyrics and merged in other relevant information. The sentiment analysis was conducted using the sentiments dataset in the tidytext package; I used the afinn and nrc lexicons because they render a numerical and categorical method of measuring a word’s sentiment. The afinn score and nrc sentiment composition for each track and album were calculated then standardized for comparison. In addition, I have examined West’s most commonly used words. 


###My Approach
* Extract lyrics from Genius API 
* Break lyrics into singular words
*	Get each word’s afinn score and nrc sentiment
*	Visualize the change in such ratings over time
*	Examine patterns and numbers for analysis




### Questions Asked
*	What are the most frequently used words and phrases?
*	How has the positivity/negativity rating changed for each album, as well within each album?
* How does the sentiment of albums compare with neutral words included and excluded?
*	How does the sentiment composition of each album differ from one another?
*	How have specific emotions in his lyrics changed over time?
*	Are Kanye West’s songs musically and lyrically consistent in terms their mood?


```{r, echo=FALSE}
# load in libraries and packages
devtools::install_github("josiahparry/geniusR")
library(spotifyr)
library(geniusR)
library(tidytext)
library(tidyverse)
library(ggplot2)
library(radarchart)
library(devtools)
library(yarrr)
library(knitr)
library(kableExtra)
library(reshape)
library(wordcloud)
library(RColorBrewer)

Sys.setenv(SPOTIFY_CLIENT_ID = '32bf3137c383403ea46edec3114b89c4')
Sys.setenv(SPOTIFY_CLIENT_SECRET = '341f33d4daff4cdcbaf7cc728ab1e44b')
access_token <- get_spotify_access_token()


```




###Scraping and Wrangling Lyrics From Kanye's Albums

I applied on Spotify’s and Genius’s API websites for keys (Client ID and Client Code) to obtain access to the information. The code for scraping and wrangling the lyrics can be read [here](https://github.com/stehuang/Kanye-West-Sentiment-Analysis/blob/master/Scrap_and_Tokenize_Lyrics.R)




### What are the most frequently used words and phrases?
To get a general idea of the themes in each albums, I calculated the tf-idf, Term Frequency-Inverse Document Frequency, of each word. The tf-idf consists of two quantities:

* Term Frequency(tf): how frequently a word occurs in a song
*	Inverse Document Frequency(idf): how important word is to a song in the album

The tf-idf is the frequency of a term adjusted for how rarely it is used. I also removed common words like “there”, “I”, and “ayy” to only examine words with more meaning. 


```{r, echo=F}
# creating list of words that we wish to exclude
redundant_words <- c("ey", "gotta", "wanna", "em", "la", "uh", "ah", "oh", "til", "yeah", "ya", "dem", "chorus", "verse", "ai", "hey", "theres", "gon", "bout", "som", "somethin", "ay", "ayy", "ayyy", "mhm", "cuz", "da", "lah", "ohh", "ooohh")

# convert album names into factor and reorder by chronological order
lyrics$album_name <- as.factor(lyrics$album_name)
lyrics$album_name<- factor(lyrics$album_name, levels=c("The College Dropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark Twisted Fantasy", "Yeezus", "The Life Of Pablo", "ye"))
refined_lyrics <- lyrics %>% unnest_tokens(word,lyric) %>% filter(!word %in% redundant_words) %>% anti_join(stop_words) %>% group_by(album_name)
```

```{r, message=F, warning=F,results='hide',fig.width=4,fig.height=5}
# compute the tf_idf
tf_lyrics <- refined_lyrics %>% group_by(album_name) %>% count(album_name,word,sort=T) %>% bind_tf_idf(word,album_name,n)
# get word count for each album
total_words <- tf_lyrics %>% group_by(album_name) %>% summarize(total=sum(n))
# combine to tf_idf tibble
tf_lyrics <- left_join(tf_lyrics,total_words)
# plot the tf_idf
tf_lyrics %>% arrange(desc(tf_idf)) %>% 
  mutate(word = factor(word, levels = rev(unique(word)))) %>% group_by(album_name) %>% 
  top_n(12, wt = tf_idf) %>% 
  ggplot(aes(x=word,y=tf_idf, fill=album_name)) + 
  geom_col(aes(fill=album_name), show.legend = F) + 
  facet_wrap(~album_name, ncol = 2, scales = "free") + coord_flip() + theme_minimal()
```

We see that in the first few albums, Kanye used more light-hearted/generic words like “workout”, “forever”, and “study”. For Yeezus and The Life of Pablo, he used more words that mimic sounds, getting more experimental with his lyrics. On his more personal albums, 808s & Heartbreak and ye, Kanye used more words that connote feelings like "worry", "heartless", "premeditated", and "menacing". Also, across each album, there is at least one word that has a noticeably higher tf-idf value, meaning it has been frequently used in a particular song (ex: 'stronger' on the song Stronger and 'amazing' on the song Amazing)




## How has the positivity/negativity rating changed for each album, as well within each album?
I’ll be using the **afinn lexicon** to measure the positivity/negativity. As defined in the book Text Mining with R, 

> “The AFINN lexicon assigns words with a score that runs between -5 and 5, with negative scores indicating negative sentiment and positive scores indicating positive sentiment.”

It provides a numerical measurement of a word’s connotation that the degree of positivity/negativity, hence the best option out of the three. I got the afinn score for each word, then summed up the afinn score for all words and word count in each track. The standardized afinn score for each track was calculated by dividing the total score by the word count. Each dot represents a track and the bar represents the average afinn score of the album.



```{r,message=F, warning=F,results='hide'}
# read in csv that contains the afinn score of each lyric
all_songs_afinn <- read.csv("all_songs_afinn.csv")
# reorder albums by chronological order
all_songs_afinn$album_name <- factor(all_songs_afinn$album_name, levels=c("The College Dropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark Twisted Fantasy", "Yeezus", "The Life Of Pablo", "ye"))

# compute afinn score of each track
track_afinn <- all_songs_afinn %>% group_by(track_title) %>% summarize(score=sum(sentiment))

# get word count and average afinn score
temp <- all_songs_afinn %>% group_by(track_title) %>% summarize(total_words = n()) %>% mutate (score=track_afinn$score) %>% mutate(track_afinn=score/total_words)

# get album name and merge
a <- aggregate(all_songs_afinn$sentiment, list(album_name=all_songs_afinn$album_name, track_title=all_songs_afinn$track_title),sum)
avg_track_afinn <- cbind(album_name=a$album_name, temp)
```


```{r, echo=F}
levels(avg_track_afinn$album_name)[levels(avg_track_afinn$album_name)=="The College Dropout"] <- "The College \n Dropout"
levels(avg_track_afinn$album_name)[levels(avg_track_afinn$album_name)=="Late Registration"] <- "Late \n Registration"
levels(avg_track_afinn$album_name)[levels(avg_track_afinn$album_name)=="808s Heartbreak"] <- "808s & \n Heartbreak"
levels(avg_track_afinn$album_name)[levels(avg_track_afinn$album_name)=="My Beautiful Dark Twisted Fantasy"] <- "M.B.D.T.F."
```

```{r,message=F, warning=F,results='hide'}
pirateplot(formula=track_afinn~album_name,
           data= avg_track_afinn, xlab="Album Name", ylab="Average Afinn Score",
           main="Average Afinn Score of Each Album",point.o=0.25, avg.line.o=1, theme=0,
           point.pch=16, point.cex = 1.3, cex.names = .6)
```
**From the pirate plot, we see that:**

*	 The artist’s average discography afinn score is negative (around -1)
*	 “808s & Heartbreak” is the only positive album; it has more negative tracks, but the one with a score above 6 brought up the album’s mean afinn score
*	 Distribution of tracks around their respective albums’ average (below/above the mean) look relatively normal for all 8 albums. Most tracks have afinn scores not too far from the mean
*	 Starting from “808s & Heartbreak”, there is a greater change in the average afinn scores for albums
*	“Amazing” on 808s & Heartbreak is the most positive song. This is because Kanye repeats the word “amazing” throughout the song
*	 “My Beautiful Dark Twisted Fantasy” has the smallest range of scores; an explanation could be that most tracks are thematically similar, as they touched upon topics such as power, fame, and fortune
* 	All albums apart from “My Beautiful Dark Twisted Fantasy” and “ye” seems to have at least a song that is much more positive/negative than the majority; something to note is that the songs on ye are thematically similar too



### Afinn Score With and Without Neutral Words
Accounting for non-neutral words (common words & those with an afinn score of 0) isn’t an effective means to discern the positivity/negativity of an album, as 20 negative words may just account for a small percentage in one song and more in another. I computed the afinn score with neutral words included in the albums, calculated similarly to that of individual songs, to examine this:

```{r, echo=F}
# AFINN score- neutral words filtered

# creating tibble that has the average afinn score for each album (total afinn/word count)
sentiment_average <- tibble()
for(i in 1:8){
  album_average <- album_sentiment$album_afinn[i]/(album_sentiment$total_words[i])
  album_average <- cbind(album_name = album_sentiment$album_name[i], album_average)
  sentiment_average <- rbind(sentiment_average,album_average)
}
# replacing numbers with the actual album title
sentiment_average$album_name <- factor(album_sentiment$album_name, levels=c("The College Dropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark Twisted Fantasy", "Yeezus", "The Life Of Pablo", "ye"))

# FINAL PRODUCT: AFINN SCORE OF EACH ALBUM
# head(sentiment_average)


## AFINN score- neutral words included

# relevel the factors by album release date
lyrics_token$album_name <- factor(lyrics_token$album_name, levels=c("The College Dropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark Twisted Fantasy", "Yeezus", "The Life Of Pablo", "ye"))
# get total words in each album; the frequency table tells you how many entries (which are words) of an album there are
all_words <- table(lyrics_token$album_name)
# create tibble with albums & word count in each album
total_words <- tibble(album_name=c("The College Dropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark Twisted Fantasy", "Yeezus", "The Life Of Pablo", "ye"),total_words = all_words)
# get afinn score
album_sentiment <- read.csv("album_sentiment.csv")

sentiment_average_total <- tibble()
for(i in 1:8){
  album_average <- album_sentiment$album_afinn[i]/(total_words$total_words[i])
  album_average <- cbind(album_name = album_sentiment$album_name[i], album_average)
  sentiment_average_total <- rbind(sentiment_average_total,album_average)
}

# replacing numbers with the actual album title
sentiment_average_total$album_name <- factor(album_sentiment$album_name, levels=c("The College Dropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark Twisted Fantasy", "Yeezus", "The Life Of Pablo", "ye"))
# sentiment_average_total

```


```{r}
# combine the two differently computed afinn scores
multi_sentiment <- sentiment_average_total %>% mutate(filtered_average = sentiment_average$album_average)
# merge by album name
multi_sentiment <- melt(multi_sentiment, id.vars='album_name')
# plot the average afinn scores for where the neutral words are included and excluded
multi_sentiment %>% ggplot(aes(x=album_name, y=value,fill=variable)) + geom_bar(stat='identity', position='dodge', width=0.65) + coord_flip() + scale_x_discrete(limits=rev(sentiment_average$album_name)) + labs(title="Average AFINN Score of Each Album", x = "Album Name", y="AFINN Score (sum of afinn scores/word count)") + scale_fill_discrete(name="Legend", labels=c("Neutral Words Included", "Neutral Words Excluded")) + theme(legend.position="bottom", legend.background = element_rect(colour = 'grey'),legend.key.size = unit(0.3, "cm"), plot.title = element_text(hjust=0.5))

```

We see that there is a greater word count to non-neutral word ratio, which is expected. Let’s examine the separate graphs:



```{r, echo=F, message=F, warning=F, results='hide'}
# neutral words excluded
sentiment_average %>% ggplot(aes(x=album_name,y=album_average)) + geom_col(aes(weight=album_average,fill=album_name)) + coord_flip() + scale_x_discrete(limits=rev(sentiment_average$album_name))+ labs(title="Average AFINN Scores (Neutral Words Excluded)",
       x = "Album", 
       y="AFINN Score (sum of afinn scores/total non-neutral words)") + scale_fill_discrete(name="Album") + scale_fill_discrete(name="Albums", 
                      labels=c("The College\nDropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark\nTwisted Fantasy", "Yeezus", "The Life Of Pablo", "ye")) + theme(legend.background = element_rect(colour = 'grey'), legend.key.size = unit(0.4, "cm")) + theme_minimal()



# neutral words included
album_afinn <- sentiment_average_total %>% ggplot(aes(x=album_name,y=album_average)) + geom_col(aes(weight=album_average,fill=album_name)) + coord_flip() + scale_x_discrete(limits=rev(sentiment_average$album_name)) + labs(title="Average AFINN Scores (Neutral Words Included)", 
       x = "Album", y="AFINN Score (sum of afinn scores/total words in album)") + scale_fill_discrete(name="Album")

album_afinn + theme(legend.background = element_rect(colour = 'grey'), 
                    legend.key.size = unit(0.4, "cm"), 
                    plot.title = element_text(hjust=0.5)) + scale_fill_discrete(name="Albums", 
                      labels=c("The College\nDropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark\nTwisted Fantasy", "Yeezus", "The Life Of Pablo", "ye")) + theme_minimal()
```

Even including other words, the general distribution of the mean afinn score plot looks similar. This implies that the afinn score for all albums relatively to each other are not too affected. It is worthy to point out that the afinn scores of each album with neutral words did not all proportionally change; for instance, there is a greater difference in scores between the “The Life of Pablo” and “ye” when we included neutral words. 




### How does the sentiment composition of each album differ from one another?
In this section, I will use the nrc lexicon to breakdown the distribution of emotions in Kanye’s albums. As described by Text Mining with R,
> “The nrc lexicon categorizes words in a binary fashion (“yes”/“no”) into categories of positive, negative, anger, anticipation, disgust, fear, joy, sadness, surprise, and trust.”

I eliminated the positive and negative categories to opt for more specific emotions. One thing to note is that a word could be categorized as *multiple sentiments*. Here is an example of how words are categorized:


```{r, echo=F, results='hide',message=F, warning=F}

# categorizing each word by nrc categories
# also removing categories "positive" and "negative"
all_songs_nrc <- lyrics_token %>% anti_join(stop_words) %>%  inner_join(get_sentiments("nrc")) %>% filter(!sentiment %in% c("positive", "negative")) %>%  group_by(x=X, album_name=album_name, word=word)
# saving dataframe
write.csv(all_songs_nrc, file = "all_songs_nrc.csv")

# get total amount of nrc non-neutral words for each album
all_songs_nrc <- read.csv("all_songs_nrc.csv")

# getting sample words for each sentiment; ordering all words by frequency
nrc_counted <- all_songs_nrc %>% group_by(sentiment) %>% filter(!word %in% redundant_words)  %>% count(word, sort=T)
# converting factors to strings
nrc_counted$word <- as.character(nrc_counted$word)
# extracting the top 5 words from each category
anger <- nrc_counted[nrc_counted$sentiment=="anger",]$word[c(1:10)]
disgust <- nrc_counted[nrc_counted$sentiment=="disgust",]$word[c(1:10)]
fear <- nrc_counted[nrc_counted$sentiment=="fear",]$word[c(1:10)]
sadness <- nrc_counted[nrc_counted$sentiment=="sadness",]$word[c(1:10)]
trust <- nrc_counted[nrc_counted$sentiment=="trust",]$word[c(1:10)]
surprise <- nrc_counted[nrc_counted$sentiment=="surprise",]$word[c(1:10)]
anticipation <- nrc_counted[nrc_counted$sentiment=="anticipation",]$word[c(1:10)]
joy <- nrc_counted[nrc_counted$sentiment=="joy",]$word[c(1:10)]
# binding all categories together
sample_words <- as.data.frame(cbind(anger,disgust,fear,sadness,trust,surprise,anticipation,joy)[c(1:5),])
```

```{r}
# making a table that displays the top 5 words for each sentiment
sample_words %>% kable("html",caption = "Top 5 Words for Each Sentiment", align="c", escape=F) %>% kable_styling(c("striped", "bordered"), font_size=12, position="center",full_width = FALSE) %>% row_spec(0, bold = T, background = "#FEF3ED", font_size = 13)
```




##### Now let’s look at the breakdown of sentiments for each album, visualized by a radar-chart. I placed more positive sentiments on the left half and more negative ones on the right half. 

```{r, echo=F, results='hide',message=F, warning=F}
# get the amount of words per sentiment per album
total_sentiment_count <- all_songs_nrc %>% group_by(album_name,sentiment) %>% summarize(total_words = n())
total_sentiment_count$album_name<- factor(total_sentiment_count$album_name, levels=c("The College Dropout", "Late Registration", "Graduation", "808s Heartbreak", "My Beautiful Dark Twisted Fantasy", "Yeezus", "The Life Of Pablo", "ye"))
# total_sentiment_count$album_name<- total_sentiment_count$album_name[c(5,3,2,1,4,8,6,7)]
# table(total_sentiment_count$album_name)

# get the amount of sentiment words for each album
total_album_count <- all_songs_nrc %>% count(album_name)

# get percentage of sentiment per album
sentiment_radar <- total_sentiment_count %>% inner_join(total_album_count, by = "album_name") %>% mutate(percentage=(total_words/n)*100) %>% select (-total_words,-n) %>% spread(album_name,percentage)

# rounding up percentages
sentiment_radar[,2:9] <- round(sentiment_radar[,2:9],2)

# reordering the sentiments so that similar feelings are placed by eachother
#sentiment_radar$sentiment <- sentiment_radar$sentiment[c(1,3,4,6,8,7,2,5)]
sentiment_radar$sentiment<- factor(sentiment_radar$sentiment, levels=c("anger", "disgust", "fear", "sadness", "trust", "anticipation", "surprise", "joy"))
sentiment_radar<-sentiment_radar[order(sentiment_radar$sentiment), ]
```

```{r}
# creating the sentiment radar-chart
chartJSRadar(sentiment_radar,showToolTipLabel=TRUE, main="Sentiment Distribution of Each Album", labelSize = 14, scaleStartValue = 3, maxScale=20, scaleStepWidth = 2,height=400, width=600)

```
**Here are some observations:**

*	On average, surprise has been the weakest sentiment in Kanye’s lyrics
*	Disgust comes in second. However, MBDTF has a higher composition of disgust, which possibly relates to the themes the artists touched upon (fame/fortune/power)
*	For each sentiment, we don’t see an apparent pattern related to the albums’ release order. If the percentages were ordered from least to greatest or vice versa for each sentiment, they would not be in the albums’ chronological order
*	None of the shapes of each album-sentiment breakdown are symmetrical and most have at least one vertex that stands out; this means that some sentiments are indeed much more emphasized in the lyrics

To better examine the change over time, I have plotted the change in individual sentiments over time:

```{r,echo=F,message=F, warning=F, results='hide'}
# computing albums and their distributions of sentiments
#total_sentiment_count$sentiment <- total_sentiment_count$sentiment[c(1,3,4,6,8,7,2,5)]
sentiment_table <- total_sentiment_count %>% inner_join(total_album_count, by = "album_name") %>% mutate(percentage=(total_words/n)*100) %>% select (-total_words,-n)

# relevel sentiments
sentiment_table$sentiment <- factor(sentiment_table$sentiment, levels=c("anger", "disgust", "fear", "sadness", "trust", "surprise", "anticipation", "joy"))
neworder <- c("anger", "disgust", "fear", "sadness", "trust", "anticipation", "surprise", "joy")

# plotting the change over time, by sentiment
sentiment_cot <- sentiment_table %>% ggplot(aes(x=album_name,y=percentage, group=sentiment, fill=album_name)) + geom_line(aes(color=sentiment))  + geom_point(aes(color=sentiment)) + facet_wrap(. ~ sentiment, nrow=2) 

# formatting
sentiment_cot + ggtitle("Kanye West's Lyrical Sentiments' Change Over Time") + scale_x_discrete(name="Album", labels=c(1:8)) + ylab("Percentage (%)")+ theme(axis.title=element_text(size=10), legend.position="bottom",legend.background = element_rect(colour = 'grey'),legend.key.size = unit(0.3, "cm"), plot.title = element_text(hjust=0.5))+  scale_fill_discrete("Album", labels=c("The College Dropout", "Late Registration", "Graduation", "808s & Heartbreak", "My Beautiful Dark\nTwisted Fantasy", "Yeezus", "The Life Of Pablo", "ye")) + scale_color_discrete(guide=FALSE) + guides(fill = guide_legend(override.aes = list(shape=c(49:56),size=2.1)))

```


**Some observations include:**

*	Large variations in the change; for instance, the presence of sadness in his lyrics has fluctuated for every album, but the difference in percentages between albums has decreased over time
*	There is a visible decrease of anticipation, although the range is around 5%
*	Relating back to the afinn scores, the most positive album “808s & Heartbreak” has the highest lyrical percentage of joy. This may tell indicate that part of the positivity sources from lyrics connoting happiness
*	The least positive album “Yeezus” has high percentages in anger and fear. The negativity may partially come from lyrics connoting anger and fear
*	Surprise is the least common lyrical sentiment. The difference between its max and min is only 4%
*	If we were to examine the general shape of the line, trust and anticipation have decreased overtime, and fear and sadness have increased overtime



## Conclusion
Here is a summary of my key findings:

* The majority of Kanye's most commonly used words are either generic (i.e. regular nouns) or thematically important to the song it appears in
* Most albums (7/8) contain more negative sentiments, meaning that most songs contain more negative than positive words
* My Beautiful Dark Twisted Fantasy is the most thematically cohesive album because its songs have the smallest range of afinn scores
* On 6 of the 8 albums, there is at least one songs who's lyrics reflect a mood that is much more positive/negative the other songs'
* The difference in afinn scores for each albums are similar for when neutral words are included/excluded. This may mean that Kanye has retained a similar ratio of neutral words to non-neutral words, and that results from the boxplot (or known as pirate plot) hold
* No album exemplifies an equal distribution of emotions in its lyrics. There is at least one sentiment that stands out more than the others
* Out of the 8 sentiments, anger and joy on average are the most dominant in the artist's lyrics
* Throughout the years, there is an increase of fear & sadness and a decrase in trust & anticipation
* The change in sentiment is not exemplified by a linear model; we see fluctuations in Kanye's mood in between albums that would render it difficult to predict a specific sentiment



### Thank you for reading
Feel free to reach out to me for comments or questions!









`







